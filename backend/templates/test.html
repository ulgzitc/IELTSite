{% load ielts_tags %} <!-- Load our custom python script -->

<form method="post">
    {% csrf_token %}

    {% for group in questions %}
        
        <div class="question-block mb-8 p-6 bg-white rounded shadow">
            
            <!-- LOGIC 1: GAP FILLS -->
            {% if group.question_type == 'gap_fill' %}
                <h3 class="font-bold mb-4">Complete the summary:</h3>
                
                <!-- 
                    Here is the magic. 
                    1. We take group.content
                    2. We pass it through |render_gap_fill
                    3. Django outputs the text with inputs inside it.
                -->
                <div class="leading-loose text-lg">
                    {{ group.content|render_gap_fill }}
                </div>


            <!-- LOGIC 2: GRIDS -->
            {% elif group.question_type == 'grid' %}
                <h3 class="font-bold mb-4">Classify the following:</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>Description</th>
                            <!-- Loop through Columns (A, B, C) -->
                            {% for col in group.data.cols %}
                                <th class="text-center px-4">{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through Rows -->
                        {% for row_text in group.data.rows %}
                            <tr>
                                <td class="py-2">{{ row_text }}</td>
                                
                                <!-- Loop through Columns to make Radio Buttons -->
                                {% for col in group.data.cols %}
                                    <td class="text-center">
                                        <!-- 
                                            We need a unique name for each row so they can only pick one per row.
                                            We use the loop counter or a specific ID from JSON.
                                        -->
                                        <input type="radio" 
                                               name="question_{{ group.data.question_ids|slice:forloop.parentloop.counter0|first }}" 
                                               value="{{ col }}">
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            {% endif %}

        </div>

    {% endfor %}

    <button type="submit">Submit Test</button>
</form>
